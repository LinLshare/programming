# Go 编程之规范

## 编程规约

## 命名风格

1. 【强制】代码中的命名不允许以下划线 `_` 开始以及结束。

   > 反例：\_foo bar\_

2. 【强制】命名要见名知义，不使用不通用的简写、国际不通行的拼音甚至中英混用。

   > 正例：isbn huawei
   >
   > 反例：a // 无意义 GetDianPuName\(\) // 获取店铺名

3. 【强制】包外可用的常量、变量、方法和函数大驼峰，包外不可用的则小驼峰。
4. 【强制】错误结构体命名使用 Error 结尾。
5. 【强制】包名小驼峰，不使用下划线 \_ ，除 test 文件可以使用 \_test 结尾。
6. 【强制】包名要与包路径的最后一个元素一致。

   > 说明：Go 包有名称和路径之别，包名由其源码文件中的 package 语句指定，用户代码将其用作包的已导出名的前缀。而用户路径用于导入包。两者不一致会使包使用方迷惑。
   >
   > 反例：
   >
   > ```go
   > // path: x/time 
   > package date 
   > func Parse(timeMillis uint64) string{} 
   >
   > // path: app 
   > package app 
   > import "x/time" 
   > func main(){ 
   >     date.Parse(1564199929000) 
   > }
   > ```

7. 【强制】包名不能使用 util、common 等过于通用的名称。

   > 说明：过于通用的名称会随着项目的发展堆积越来越多的各式各样的函数，加大了维护的复杂度。好的包名应该说明其专一性。

8. 【强制】包内容（包括常量、变量、方法和函数）不重复包名。

   > 正例：http.Server time.Now\(\)
   >
   > 反例：http.HTTPServer time.NowTime\(\)

9. 【强制】函数以及方法的命名应是动词或动名词，Getter 除外。

   > 正例：SetId\(\) Id\(\)

10. 【推荐】只包含一个方法的接口应当以该方法的名称加上-er后缀来命名

    > 正例：Reader Formatter

11. 【推荐】当函数返回值超过 2 个时，命名返回值。

    > 正例：func divide\(left, right float64\) \(result float64, err error\)

12. 【推荐】DAO 层命名规约：
    * Getter 函数不需要以 Get 开头，而 Setter 函数要以 Set 开头。 
    * 获取多个值的函数以 list\(List\) 开头。 
    * 获取统计值的函数以 count\(Count\) 开头。 
    * 插入数据的函数以 insert\(Insert\)/save\(Save\) 开头。 
    * 删除数据的函数以 remove\(Remove\)/update\(Update\) 开头。 
    * 修改数据的函数以 update\(Update\) 开头。 

#### 代码格式

1. 【强制】使用 gofmt 格式化代码。
2. 【推荐】函数定义的顺序依次是:包公有方法 &gt; 包私有方法 &gt; getter/setter

   方法。

3. 【推荐】使用 switch 代替 if-then-else，使整个结构更加明朗。

#### 访问控制

1. 【强制】初始化后不变的值应声明为 const，而不是 var。
2. 【强制】当无法确定常量、变量、函数或方法是否要公开时，应设置为包私有。

   > 说明：包应该是内聚的，以使得包外对其内部最少了解为原则。

#### 数据集

1. 【推荐】使用 make 创建切片或映射，并设置合适的容量，避免扩张时不必要的内存拷贝。
2. 【推荐】使用 for range 迭代数组、切片和映射。

   ```go
   // 遍历数组或切片
   a := ["apple", "banana", "orange"]
   for i := range a {}
   for i, v := range a {}
   for _, v := ranga        ``1`5ee a {}
   // 遍历映射
   m := map[int]string{
     1: "Google",
     2: "Apple",
     3: "Microsoft",
   }
   for k, v := range m {}
   ```

## 异常日志

### 异常处理

1. 【强制】不在导出函数中抛出异常，而是将内部异常转化为明确的 error。
2. 【强制】当无错误时，直接返回无类型的 nil，而不是特定类型的 nil。

   > 说明：不同类型的 nil 不可比较。

### 日志规约

1. 【强制】生产环境禁止 debug 级别的日志。
2. 【推荐】使用占位符形式输出日志。
3. 【推荐】日志文件命名方式：`{应用名}_{日志级别}.log`

## 设计规约

1. 【强制】数据结构的设计需面向领域设计，并获得评审一致通过。
2. 【推荐】需求分析阶段，当与系统交互的用户超过 1 类时且用例超过 5 个时，使用用例图描述。
3. 【推荐】当某一对象的状态超过 3 个时，使用状态图描述。
4. 【推荐】当某一功能的调用链路涉及超过 3 个对象时，使用时序图描述。
5. 【推荐】同一文件中的函数应该处理同一类事。

